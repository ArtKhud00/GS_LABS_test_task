# GS_LABS_test_task
Тестовое задание для GS_Labs. Суть задания заключается в следующем. Требуется разработать сетевой балансировщик нагрузки, работающий в системе Linux, который бы обладал следующими возможностями:
  1. читать настройки из конфигурационного файла произвольного формата;
  2. принимать `UDP`-датаграммы с определенного порта(задается файлом конфигурации);
  3. перенаправлять датаграммы из п.2 на один из нескольких узлов(серверов) таким образом, чтобы нагрузка на узлы распределялась равномерно.(адреса узлов задаются файлом конфигурации);
  4. ограничивать нагрузку на узлы, общее количество датаграмм проходящих через балансировщик не должно превышать N в секунду(задается файлом конфигурации), лишние датаграммы отклоняются.

## Особенности реализации
  1. Для работы с конфигурационным файлом был выбран формат JSON и реализована библиотека для работы с JSON документами. Структура JSON файла следующая:
```
{
	"src_port" : 8081,
	"nodes_adresses" : ["127.0.0.1:8080", "127.0.0.1:8083", "127.0.0.1:8084"],
	<"nodes_weights" : [1, 3, 2],>
	"max_datagrams_per_second" : 30000
}
```
Строка `nodes_weights` является опциональной. Ее наличие объясняется в следующем пункте.
  2. В качестве алгоритма балансировки нагрузки был выбран Weighted Round Robin, который учитывает тот факт, что серверы могут быть различными и это различие серверов, например по производительности, можно задать с помощью массива весов. Если в конфигурационном файле не указаны значения весов, то по умолчанию полагается, что все узлы одинаковы и имеют веса, равные `1`.
  
## Проверка работоспособности
Для проверки работоспособности были разработаны вспомогательные программы: генератор UDP-датаграмм и 3 приложения, выполняющих роль узлов. Для проверки работоспособности необходимо скомпилировать и запустить программу балансировщика нагрузки, программы - узлы и в последнюю очередь запускается генератор датаграмм. Для удобства наблюдения в программах - узлах выводится значение счетчика - количество принятых датаграмм от балансировщика нагрузки.

## Пример сборки
Для сборки программы балансировщика нагрузки используется система сборки `CMake`. Рекомендуется осуществлять сборку проекта в отдельной директории, чтобы не испортить директорию с исходным кодом, так в процессе сборки создаются вспомогательные файлы CMake, промежуточные файлы компиляции. Возможная структура каталога для сборки:
```
load-balancer
├── load-balancer/ # папка с исходным кодом
│   ├── CMakeLists.txt
│   ├── configuration_parse.cpp
│   ├── configuration_parse.h
│   ├── json.cpp
│   ├── json.h
│   ├── LoadBalancer.cpp
│   ├── LoadBalancer.h
│   ├── main.cpp
│   ├── WeightedRoundRobin.cpp
│   └── WeightedRoundRobin.h
└── load-balancer-build /  # папка для сборки
    └── # тут будут файлы сборки
```
Команда для сборки:
```
cd load-balancer-build/
cmake ../load-balancer/ 
cmake --build .
```
